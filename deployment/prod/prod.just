# Production Deployment Commands for Science Talk
# Usage: just prod <command>

# Automatically load .env file (creates TF_VAR_* environment variables for Terraform)
set dotenv-load

# Service name (must match Terraform var.project_name)
SERVICE_NAME := "talk"

# AWS region
AWS_REGION := "us-east-1"

# AWS profile (override with: AWS_PROFILE=myprofile just prod <command>)
AWS_PROFILE := "rb2053" #env_var_or_default("AWS_PROFILE", "default")

# List all production commands
default:
    @just --list --justfile {{justfile()}}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Environment Configuration
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Create terraform.tfvars from example
env-setup:
    @if [ -f terraform.tfvars ]; then \
        echo "âŒ terraform.tfvars already exists. Delete it first if you want to recreate."; \
        exit 1; \
    fi
    cp terraform.tfvars.example terraform.tfvars
    @echo "âœ… Created terraform.tfvars"
    @echo "ğŸ“ Edit this file and set your domain"
    @echo ""
    @echo "Required changes:"
    @echo "  1. Set domain_name to your domain (e.g., 'example.com')"
    @echo ""
    @echo "Optional changes:"
    @echo "  - project_name (default: 'talk')"
    @echo "  - subdomain (default: 'talk')"
    @echo "  - container_power (default: 'micro')"
    @echo ""
    @echo "âœ… Secrets are auto-generated by Terraform (no manual work!)"

# Show current configuration (reads from terraform.tfvars)
[working-directory: 'tf']
env-show:
    @echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    @echo "ğŸ“ Production Environment Configuration"
    @echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    @terraform console -var-file=terraform.tfvars <<< 'var.project_display_name' | xargs echo "Project:"
    @terraform console -var-file=terraform.tfvars <<< 'var.domain_name' | xargs echo "Domain:"
    @terraform console -var-file=terraform.tfvars <<< 'var.subdomain' | xargs echo "Subdomain:"
    @echo "Region: {{AWS_REGION}}"
    @echo ""
    @echo "âœ… Secrets auto-generated by Terraform"
    @echo "   - Database password: [stored in state]"
    @echo "   - JWT secret: [stored in state]"

# Show GitHub Actions setup instructions (after terraform apply)
[working-directory: 'tf']
env-show-secrets:
    #!/usr/bin/env bash
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "ğŸ” GitHub Actions Setup"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    echo "âœ… Terraform has automatically generated .env file at:"
    echo "   deployment/prod/.env"
    echo ""
    echo "The file contains all required configuration:"
    echo "  âœ… Database URL (with auto-generated password)"
    echo "  âœ… JWT secret (64 chars, auto-generated)"
    echo "  âœ… API URLs (from your domain config)"
    echo ""
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "ğŸ“‹ Add these 3 GitHub Secrets:"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    echo "1. ENV_FILE"
    echo "   Copy entire .env file:"
    echo "   "
    echo "   cat deployment/prod/.env | pbcopy   # macOS"
    echo "   cat deployment/prod/.env | xclip    # Linux"
    echo ""
    echo "   Then: GitHub â†’ Settings â†’ Secrets â†’ Actions â†’ New secret"
    echo "   Name: ENV_FILE"
    echo "   Value: (paste)"
    echo ""
    echo "2. AWS_ACCESS_KEY_ID & AWS_SECRET_ACCESS_KEY"
    echo "   Get credentials:"
    echo ""
    echo "   just prod tf-cicd-creds"
    echo ""
    echo "   Copy each value to GitHub Secrets"
    echo ""
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "ğŸš€ Deploy"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    echo "git push origin main"
    echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Terraform Commands
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[working-directory: 'tf']
tf CMD="":
    terraform {{CMD}}

# Initialize Terraform
[working-directory: 'tf']
tf-init:
    terraform init

# Validate Terraform configuration
[working-directory: 'tf']
tf-validate:
    terraform validate

# Format Terraform files
[working-directory: 'tf']
tf-fmt:
    terraform fmt

# Show Terraform plan
[working-directory: 'tf']
tf-plan:
    terraform plan

# Apply Terraform changes
[working-directory: 'tf']
tf-apply:
    terraform apply

# Apply Terraform changes without confirmation (use with caution!)
[working-directory: 'tf']
tf-apply-auto:
    terraform apply -auto-approve

# Destroy all infrastructure (WARNING: DESTRUCTIVE!)
[working-directory: 'tf']
tf-destroy:
    @echo "âš ï¸  WARNING: This will destroy ALL production infrastructure!"
    @echo "Press Ctrl+C to cancel, or Enter to continue..."
    @read
    terraform destroy

# Show all Terraform outputs
[working-directory: 'tf']
tf-output:
    terraform output

# Get JWT secret (for GitHub Secrets)
[working-directory: 'tf']
tf-jwt-secret:
    @terraform output -raw jwt_secret

# Get database URL (for GitHub Secrets)
[working-directory: 'tf']
tf-db-url:
    @terraform output -raw database_url

# Get Route 53 nameservers
[working-directory: 'tf']
tf-nameservers:
    @terraform output -json route53_nameservers

# Get CI/CD credentials (for GitHub Secrets)
[working-directory: 'tf']
tf-cicd-creds:
    @echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    @echo "ğŸ” CI/CD User Credentials (for GitHub Secrets)"
    @echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    @echo ""
    @echo "AWS_ACCESS_KEY_ID:"
    @terraform output -raw cicd_access_key_id
    @echo ""
    @echo ""
    @echo "AWS_SECRET_ACCESS_KEY:"
    @terraform output -raw cicd_secret_access_key
    @echo ""
    @echo ""
    @echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# Show next steps after Terraform apply
[working-directory: 'tf']
tf-next-steps:
    @terraform output -raw next_steps

# Save all outputs to JSON file
[working-directory: 'tf']
tf-save-outputs:
    terraform output -json > terraform-outputs.json
    @echo "âœ… Outputs saved to tf/terraform-outputs.json"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Setup & Configuration
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Show deployment checklist
checklist:
    @echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    @echo "ğŸ“‹ Production Deployment Checklist"
    @echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    @echo ""
    @echo "1ï¸âƒ£  Configuration"
    @echo "   [ ] just prod env-setup"
    @echo "   [ ] Edit deployment/prod/terraform.tfvars"
    @echo "   [ ] Set domain_name to your domain"
    @echo "   [ ] âœ… Secrets auto-generated (no manual work!)"
    @echo ""
    @echo "2ï¸âƒ£  Deploy Infrastructure"
    @echo "   [ ] just prod tf-init"
    @echo "   [ ] just prod tf-plan"
    @echo "   [ ] just prod tf-apply"
    @echo ""
    @echo "3ï¸âƒ£  Configure DNS"
    @echo "   [ ] just prod tf-nameservers"
    @echo "   [ ] Update nameservers at domain registrar"
    @echo "   [ ] Wait 24-48 hours for DNS propagation"
    @echo ""
    @echo "4ï¸âƒ£  Configure GitHub Secrets"
    @echo "   [ ] just prod env-show-secrets"
    @echo "   [ ] Copy generated .env to GitHub as ENV_FILE secret"
    @echo "   [ ] just prod tf-cicd-creds (get AWS credentials)"
    @echo "   [ ] Add AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY to GitHub Secrets"
    @echo ""
    @echo "5ï¸âƒ£  Deploy Application"
    @echo "   [ ] git push origin main"
    @echo "   [ ] Or: just prod deploy"
    @echo ""
    @echo "6ï¸âƒ£  Verify Deployment"
    @echo "   [ ] just prod status"
    @echo "   [ ] just prod health"
    @echo "   [ ] just prod logs"
    @echo ""
    @echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# AWS Lightsail Commands
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Show container service status
status:
    @echo "ğŸ“Š Container Service Status:"
    @aws lightsail get-container-services \
        --service-name {{SERVICE_NAME}} \
        --region {{AWS_REGION}} \
        --profile {{AWS_PROFILE}} \
        --query 'containerServices[0].[name,state,power,scale,url]' \
        --output table

# Show deployment status
deploy-status:
    @echo "ğŸš€ Deployment Status:"
    @aws lightsail get-container-service-deployments \
        --service-name {{SERVICE_NAME}} \
        --region {{AWS_REGION}} \
        --profile {{AWS_PROFILE}} \
        --query 'deployments[0:3].[version,state,createdAt]' \
        --output table

# View container logs (last 10 minutes)
logs:
    @aws lightsail get-container-log \
        --service-name {{SERVICE_NAME}} \
        --container-name app \
        --region {{AWS_REGION}} \
        --profile {{AWS_PROFILE}} \
        --start-time $(date -u -v-10M +%Y-%m-%dT%H:%M:%SZ) \
        | jq -r '.logEvents[]? | "[" + .createdAt + "] " + .message'

# Follow logs (polls every 5 seconds)
logs-follow:
    @echo "Following logs (Ctrl+C to stop)..."
    @while true; do \
        aws lightsail get-container-log \
            --service-name {{SERVICE_NAME}} \
            --container-name app \
            --region {{AWS_REGION}} \
            --profile {{AWS_PROFILE}} \
            --start-time $(date -u -v-30S +%Y-%m-%dT%H:%M:%SZ) \
            2>/dev/null | jq -r '.logEvents[]? | "[" + .createdAt + "] " + .message' || true; \
        sleep 5; \
    done

# Test health endpoint
health:
    @URL=$(aws lightsail get-container-services \
        --service-name {{SERVICE_NAME}} \
        --region {{AWS_REGION}} \
        --profile {{AWS_PROFILE}} \
        --query 'containerServices[0].url' \
        --output text); \
    echo "ğŸ¥ Health check: $$URL/health"; \
    curl -f "$$URL/health" || echo "\nâŒ Health check failed"

# Show database status
db-status:
    @echo "ğŸ—„ï¸  Database Status:"
    @aws lightsail get-relational-database \
        --relational-database-name {{SERVICE_NAME}}-db \
        --region {{AWS_REGION}} \
        --profile {{AWS_PROFILE}} \
        --query 'relationalDatabase.[name,relationalDatabaseBundleId,masterEndpoint,state]' \
        --output table

# List database snapshots
db-snapshots:
    @echo "ğŸ’¾ Database Snapshots:"
    @aws lightsail get-relational-database-snapshots \
        --region {{AWS_REGION}} \
        --profile {{AWS_PROFILE}} \
        --query 'relationalDatabaseSnapshots[?contains(name,`{{SERVICE_NAME}}`)].{Name:name,CreatedAt:createdAt,State:state}' \
        --output table

# Create manual database snapshot
db-snapshot:
    @SNAPSHOT_NAME="{{SERVICE_NAME}}-manual-$(date +%Y%m%d-%H%M%S)"; \
    echo "Creating snapshot: $$SNAPSHOT_NAME"; \
    aws lightsail create-relational-database-snapshot \
        --relational-database-name {{SERVICE_NAME}}-db \
        --relational-database-snapshot-name $$SNAPSHOT_NAME \
        --region {{AWS_REGION}} \
        --profile {{AWS_PROFILE}}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Deployment Commands
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Trigger GitHub Actions deployment manually
deploy:
    @echo "ğŸš€ Triggering GitHub Actions deployment..."
    @echo "This requires 'gh' CLI to be installed and authenticated."
    @gh workflow run deploy.yml

# Show recent GitHub Actions runs
deploy-history:
    @echo "ğŸ“œ Recent Deployments:"
    @gh run list --workflow=deploy.yml --limit 10

# View logs from latest GitHub Actions deployment
deploy-logs:
    @gh run view --log

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Monitoring & Debugging
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Show all important info (status, health, recent logs)
info:
    @echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    @echo "ğŸ“Š Science Talk Production Status"
    @echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    @echo ""
    @just prod status
    @echo ""
    @just prod deploy-status
    @echo ""
    @just prod db-status
    @echo ""
    @just prod health
    @echo ""
    @echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# Connect to database (requires psql)
db-connect:
    @DB_ENDPOINT=$(aws lightsail get-relational-database \
        --relational-database-name {{SERVICE_NAME}}-db \
        --region {{AWS_REGION}} \
        --profile {{AWS_PROFILE}} \
        --query 'relationalDatabase.masterEndpoint.[address,port]' \
        --output text | tr '\t' ':'); \
    echo "Connecting to database at $$DB_ENDPOINT..."; \
    echo "Note: You'll need the database password from terraform.tfvars"; \
    psql "postgresql://dbadmin@$$DB_ENDPOINT/talk"

# Show current costs (requires AWS Cost Explorer to be enabled)
costs:
    @echo "ğŸ’° Estimated Monthly Costs:"
    @echo "This requires AWS Cost Explorer to be enabled in your account."
    @aws ce get-cost-and-usage \
        --time-period Start=$(date -u -d '1 month ago' +%Y-%m-%d),End=$(date -u +%Y-%m-%d) \
        --granularity MONTHLY \
        --metrics "UnblendedCost" \
        --filter file://<(echo '{"Tags":{"Key":"Project","Values":["Science Talk"]}}') \
        --region us-east-1 \
        --profile {{AWS_PROFILE}} 2>/dev/null || \
        echo "Cost Explorer not available or not enabled"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Danger Zone
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Rollback to previous deployment
rollback:
    @echo "âš ï¸  Rolling back to previous deployment..."
    @echo "This will redeploy the previous container image."
    @echo "Press Ctrl+C to cancel, or Enter to continue..."
    @read
    @echo "Not yet implemented - check deployment history and manually redeploy"
    @just prod deploy-history

# Delete container service (WARNING: DESTRUCTIVE!)
danger-delete-container:
    @echo "ğŸ”´ WARNING: This will delete the container service!"
    @echo "The database will remain. You can recreate the container with Terraform."
    @echo "Press Ctrl+C to cancel, or type 'delete' and press Enter to continue..."
    @read CONFIRM; \
    if [ "$$CONFIRM" = "delete" ]; then \
        aws lightsail delete-container-service \
            --service-name {{SERVICE_NAME}} \
            --region {{AWS_REGION}} \
            --profile {{AWS_PROFILE}}; \
    else \
        echo "âŒ Cancelled"; \
    fi

# Delete database (WARNING: DESTRUCTIVE!)
danger-delete-database:
    @echo "ğŸ”´ WARNING: This will delete the database!"
    @echo "A final snapshot will be created automatically."
    @echo "Press Ctrl+C to cancel, or type 'delete' and press Enter to continue..."
    @read CONFIRM; \
    if [ "$$CONFIRM" = "delete" ]; then \
        aws lightsail delete-relational-database \
            --relational-database-name {{SERVICE_NAME}}-db \
            --region {{AWS_REGION}} \
            --profile {{AWS_PROFILE}}; \
    else \
        echo "âŒ Cancelled"; \
    fi
